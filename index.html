<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TipTap | ×”×›×¨×˜×™×¡ ×”×—×›×</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js" defer></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Heebo', sans-serif; background: #f0f4f8; overflow-x: hidden; touch-action: manipulation; }
        
        /* Glass Style */
        .glass { 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255,255,255,0.6); 
            box-shadow: 0 20px 40px -5px rgba(0,0,0,0.05); 
        }

        .fade-in-up { animation: fadeInUp 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Loader */
        .loader-ring { width: 32px; height: 32px; border: 3px solid #e2e8f0; border-top: 3px solid #3b82f6; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        .btn-press:active { transform: scale(0.96); opacity: 0.9; transition: 0.1s; }
        
        /* FAQ Styling */
        details > summary { list-style: none; } 
        details > summary::-webkit-details-marker { display: none; }
        
        /* Toast Animation Class (for JS) */
        .toast-visible { opacity: 1 !important; transform: translate(-50%, 0) !important; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbwEetH73WOCUrLOuNoyUNByH0JAFlxqSdi3UDJJdP5LwV9Z3WXQQDITaHM6hscW89e-/exec"; 
        const ASSETS = {
            main: "https://raw.githubusercontent.com/mc26589/EASYTIP/main/1767290938556.jpg.jpeg",
            bit: "https://raw.githubusercontent.com/mc26589/EASYTIP/main/1200px-Bit_logo_2024.svg.png",
            guide: "https://raw.githubusercontent.com/mc26589/EASYTIP/main/Gemini_Generated_Image_34mb2434mb2434mb.png"
        };
    </script>

    <!-- â˜… TOAST NOTIFICATION COMPONENT â˜… -->
    <div id="toast-container" class="fixed top-8 left-1/2 -translate-x-1/2 z-[100] transition-all duration-300 opacity-0 -translate-y-4 pointer-events-none">
        <div id="toast-body" class="bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 min-w-[220px] justify-center backdrop-blur-md">
            <span id="toast-icon">â„¹ï¸</span>
            <span id="toast-message" class="text-sm font-bold">×”×•×“×¢×ª ××¢×¨×›×ª</span>
        </div>
    </div>

    <div class="glass w-full max-w-md rounded-[2.5rem] p-8 text-center relative flex flex-col min-h-[550px]">
        
        <header class="mb-2 z-10 relative">
            <div class="w-24 h-24 bg-white rounded-[1.5rem] mx-auto -mt-20 mb-3 shadow-xl border-4 border-white overflow-hidden">
                <img src="" id="logo-img" class="w-full h-full object-cover">
            </div>
            <h1 class="text-3xl font-black text-slate-800 italic uppercase tracking-tight">TipTap</h1>
            <p id="ui-id" class="text-[10px] text-slate-400 font-bold tracking-[0.2em] mt-1 uppercase">Loading System...</p>
        </header>

        <!-- Loader -->
        <div id="loader-view" class="flex-grow flex flex-col items-center justify-center py-12 space-y-3">
            <div class="loader-ring"></div>
            <p id="loader-text" class="text-xs font-bold text-slate-400 animate-pulse">×™×•×¦×¨ ×—×™×‘×•×¨ ×××•×‘×˜×—...</p>
        </div>

        <!-- 1. INTRO VIEW -->
        <div id="intro-view" class="hidden flex-col gap-4 fade-in-up px-1 text-right mt-4">
            <p class="text-slate-400 text-[10px] font-black uppercase tracking-widest text-center mb-2">×©×œ×‘ 1: ×‘×—×™×¨×ª ××¡×œ×•×œ</p>
            
            <button onclick="goToSetup('tip')" class="btn-press bg-white border border-blue-100 p-4 rounded-2xl flex items-center gap-4 hover:border-blue-300 hover:shadow-md transition-all">
                <div class="text-2xl bg-blue-50 p-3 rounded-xl">ğŸ’°</div>
                <div><span class="block font-black text-slate-800 text-lg">××¡×œ×•×œ ×˜×™×¤</span><span class="text-xs text-slate-400 font-bold">×—×™×‘×•×¨ ×œ-Bit</span></div>
            </button>
            
            <button onclick="goToSetup('link')" class="btn-press bg-white border border-orange-100 p-4 rounded-2xl flex items-center gap-4 hover:border-orange-300 hover:shadow-md transition-all">
                <div class="text-2xl bg-orange-50 p-3 rounded-xl">ğŸš€</div>
                <div><span class="block font-black text-slate-800 text-lg">××¡×œ×•×œ ×¢×¡×§×™</span><span class="text-xs text-slate-400 font-bold">×›×¨×˜×™×¡ ×“×™×’×™×˜×œ×™ / ××ª×¨</span></div>
            </button>
            
            <div class="mt-4 flex justify-between px-2">
                <button onclick="toggleModal('faq-modal', true)" class="text-xs font-bold text-slate-400 underline decoration-slate-200">â“ ×¢×–×¨×” ×•×©××œ×•×ª</button>
                <button onclick="toggleModal('guide-modal', true)" class="text-xs font-bold text-orange-400 underline decoration-orange-200">ğŸ“¸ ××™×š ××•×¦××™× QR?</button>
            </div>
        </div>

        <!-- 2. SETUP FORM -->
        <div id="setup-form-view" class="hidden fade-in-up flex-col gap-3 text-right">
            <button onclick="backToIntro()" class="text-[10px] font-bold text-slate-400 w-fit mb-2 hover:text-slate-600 bg-slate-100 px-3 py-1 rounded-full">âœ ×—×–×¨×”</button>
            <h2 id="setup-title" class="text-xl font-black text-slate-800 mb-2">×”×’×“×¨×ª × ×ª×•× ×™×</h2>

            <!-- A. QR Upload -->
            <div id="input-group-bit" class="hidden">
                <p class="text-xs font-bold text-slate-500 mb-1">×”×¢×œ××ª QR (××‘×™×˜)</p>
                <label id="bit-label" class="flex flex-col items-center justify-center h-28 border-2 border-dashed border-blue-200 bg-blue-50/50 rounded-2xl cursor-pointer hover:bg-blue-50 transition-colors">
                    <img src="https://raw.githubusercontent.com/mc26589/EASYTIP/main/1200px-Bit_logo_2024.svg.png" class="w-6 opacity-60 mb-2">
                    <span id="bit-text" class="text-[10px] font-bold text-blue-400 uppercase tracking-wide">×œ×—×¥ ×œ×‘×—×™×¨×ª ×§×•×‘×¥</span>
                    <input type="file" id="fixed-file-input" class="hidden" accept="image/*" onchange="handleFileSelect(this)">
                </label>
            </div>

            <!-- B. Link Input -->
            <div id="input-group-link" class="hidden">
                <p class="text-xs font-bold text-slate-500 mb-1">×§×™×©×•×¨ ×œ××ª×¨</p>
                <input type="url" id="fixed-link-input" dir="ltr" placeholder="www.website.com" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl font-bold text-sm outline-none focus:border-slate-800 transition-colors shadow-inner">
            </div>

            <!-- Common Fields -->
            <div>
                <p class="text-xs font-bold text-slate-500 mb-1 mt-2">×©× ××œ× (×™×•×¤×™×¢ ×‘×›×¨×˜×™×¡)</p>
                <input type="text" id="fixed-name-input" placeholder="×“× ×™××œ ×›×”×Ÿ" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl font-bold text-sm outline-none focus:border-slate-800 text-right">
            </div>

            <div>
                <p class="text-xs font-bold text-slate-500 mb-1 mt-2">×§×•×“ ××™×©×™ (PIN) ×œ× ×™×”×•×œ</p>
                <input type="tel" id="fixed-pin-input" maxlength="4" placeholder="â€¢â€¢â€¢â€¢" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl font-black text-center text-xl tracking-[0.5em] outline-none focus:border-slate-800">
            </div>

            <button onclick="saveCardSafe()" class="btn-press w-full bg-slate-900 text-white py-4 rounded-2xl font-black shadow-xl text-sm mt-3 flex items-center justify-center gap-2">
                <span>×©××•×¨ ×•×”×¤×¢×œ ×›×¨×˜×™×¡</span><span>ğŸš€</span>
            </button>
        </div>

        <!-- 3. ACTIVE CARD -->
        <div id="active-view" class="hidden fade-in-up flex-col text-center h-full pt-2">
            <!-- Dynamic Content -->
        </div>

    </div>

    <!-- ===== MODALS ===== -->

    <div id="faq-modal" class="fixed inset-0 bg-black/60 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm" onclick="if(event.target.id==='faq-modal') toggleModal('faq-modal', false)">
        <div class="bg-white w-full max-w-sm rounded-[2rem] p-6 shadow-2xl max-h-[85vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6 border-b pb-4">
                <h3 class="font-black text-xl text-slate-800">×¢×–×¨×”</h3>
                <button onclick="toggleModal('faq-modal', false)" class="text-slate-300 text-2xl">&times;</button>
            </div>
            <div class="space-y-3 text-right">
                <details class="group bg-slate-50 rounded-2xl border border-slate-100"><summary class="flex justify-between p-4 cursor-pointer font-bold text-slate-700 text-sm"><span>××™×š ×–×” ×¢×•×‘×“?</span><span>â–¼</span></summary><div class="p-4 pt-0 text-xs text-slate-500">×”×›×¨×˜×™×¡ ××§×©×¨ ××•×ª×š ××™×“×™×ª ×œ×œ×§×•×—×•×ª ×©×œ×š ×œ×œ× ×”×ª×§× ×ª ××¤×œ×™×§×¦×™×”.</div></details>
                <details class="group bg-slate-50 rounded-2xl border border-slate-100"><summary class="flex justify-between p-4 cursor-pointer font-bold text-slate-700 text-sm"><span>×™×© ×¢××œ×•×ª?</span><span>â–¼</span></summary><div class="p-4 pt-0 text-xs text-slate-500 font-bold text-green-600">×œ×! ×”×˜×™×¤ ×¢×•×‘×¨ ×‘×‘×™×˜ ×‘-100% ×™×©×™×¨×•×ª ××œ×™×š.</div></details>
                <details class="group bg-slate-50 rounded-2xl border border-slate-100"><summary class="flex justify-between p-4 cursor-pointer font-bold text-slate-700 text-sm"><span>××‘×˜×—×”?</span>
